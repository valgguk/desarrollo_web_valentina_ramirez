<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Detalle de aviso</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/styles.css') }}">
</head>
<body>
<header>
  <div class="container">
    <h1>Detalle del aviso</h1>
    <nav>
      <a href="{{ url_for('main.index') }}">Portada</a>
      <a href="{{ url_for('main.listado') }}">Listado</a>
  <a href="{{ url_for('main.estadisticas') }}">Estad√≠sticas</a>
    </nav>
  </div>
</header>
<main class="container">
  <section id="detalle" class="section">
    <h2>Publicaci√≥n de {{ aviso.nombre }}</h2>
    <p><strong>Fecha de publicaci√≥n:</strong> {{ aviso.fecha_ingreso.strftime('%Y-%m-%d %H:%M') }}</p>
    <p><strong>Fecha de entrega:</strong> {{ aviso.fecha_entrega.strftime('%Y-%m-%d %H:%M') }}</p>
    <p><strong>Regi√≥n:</strong> {{ aviso.comuna.region.nombre }}</p>
    <p><strong>Comuna:</strong> {{ aviso.comuna.nombre }}</p>
    <p><strong>Sector:</strong> {{ aviso.sector or '' }}</p>
    <p><strong>Cantidad - Tipo - Edad:</strong>
      {{ aviso.cantidad }} {{ aviso.tipo }}{% if aviso.cantidad>1 %}s{% endif %},
      {{ aviso.edad }} {{ 'meses' if aviso.unidad_medida=='m' else 'a√±os' }}
    </p>
    <p><strong>Contacto:</strong> {{ aviso.nombre }} ‚Äî {{ aviso.email }}{% if aviso.celular %} / {{ aviso.celular }}{% endif %}</p>
    <p><strong>Canales:</strong>
      {% if aviso.canales %}
        {% for c in aviso.canales %}
          {{ c.nombre }}: {{ c.identificador }}{% if not loop.last %}, {% endif %}
        {% endfor %}
      {% else %}(sin canales){% endif %}
    </p>
    <p><strong>Descripci√≥n:</strong> {{ aviso.descripcion or '' }}</p>
    <h3>Fotos</h3>
    <div class="galeria">
      {# Se asume que las variantes *_320x240.png y *_800x600.png est√°n cargadas. Mostramos solo las small (#320) y buscamos su par large cambiando el sufijo. #}
      {% for f in aviso.fotos %}
        {% if '_320x240' in f.ruta_archivo %}
          {% set large = f.ruta_archivo.replace('_320x240','_800x600') %}
          <img src="{{ url_for('static', filename='uploads/' ~ f.ruta_archivo) }}" alt="foto {{ loop.index }}" width="320" class="foto-chica" data-large="{{ url_for('static', filename='uploads/' ~ large) }}">
        {% endif %}
      {% endfor %}
    </div>
    <div class="acciones" style="margin-top:1rem; display:flex; gap:1rem;">
      <a href="{{ url_for('main.listado') }}">‚Üê Volver al listado</a>
      <a href="{{ url_for('main.index') }}">üè† Portada</a>
    </div>
  </section>
</main>

<!-- Modal de foto -->
<div id="modal-foto" class="modal">
  <div class="modal-content">
    <button id="cerrar-modal" class="cerrar-btn">Cerrar ‚úï</button>
    <img id="modal-foto-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" alt="foto grande">
  </div>
</div>

<footer></footer>
<script>
  // Comportamiento modal b√°sico (sin dependencia de main.js ahora)
  const modal = document.getElementById('modal-foto');
  const modalImg = document.getElementById('modal-foto-img');
  const cerrarBtn = document.getElementById('cerrar-modal');
  document.querySelectorAll('.foto-chica').forEach(img => {
    img.addEventListener('click', () => {
      modal.classList.add('visible');
      modalImg.src = img.dataset.large;
    });
  });
  cerrarBtn.addEventListener('click', ()=> modal.classList.remove('visible'));
  modal.addEventListener('click', (e)=> { if (e.target === modal) modal.classList.remove('visible'); });
</script>
</body>
</html>
